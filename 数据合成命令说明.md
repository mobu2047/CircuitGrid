# 数据合成命令说明

## 基本命令格式

```bash
python ppm_construction/data_syn/generate.py [参数]
```

---

## 命令行参数

| 参数 | 类型 | 默认值 | 说明 |
|------|------|--------|------|
| `--note` | str | `v11` | 电路生成版本号 |
| `--gen_num` | int | `100` | 要生成的基础电路数量 |
| `--num_edits` | int | `3` | 每个基础电路的编辑变体数量 |
| `--output_dir` | str | `./data/edit_dataset` | 输出目录路径 |
| `--num_proc` | int | `1` | 并行线程数 |
| `--render_image` | flag | `True` | 是否渲染LaTeX为PNG图像 |
| `--no_render` | flag | `False` | 禁用图像渲染（测试时更快） |

---

## 常用命令示例

### 1. 基础命令（使用默认参数）

```bash
python ppm_construction/data_syn/generate.py
```

**效果**:
- 生成100个基础电路
- 每个电路3个编辑变体
- 单线程运行
- 输出到 `./data/edit_dataset`
- 渲染PNG图像

---

### 2. 生成少量测试数据（快速测试）

```bash
python ppm_construction/data_syn/generate.py --gen_num 5 --num_edits 2 --no_render
```

**效果**:
- 生成5个基础电路
- 每个电路2个编辑变体
- 不渲染图像（更快）
- 总共生成：5个基础 + 10个编辑变体 = 15个电路

---

### 3. 生成大规模数据集（多线程）

```bash
python ppm_construction/data_syn/generate.py \
    --note v11 \
    --gen_num 1000 \
    --num_edits 3 \
    --num_proc 8 \
    --output_dir ./data/edit_dataset \
    --render_image
```

**效果**:
- 生成1000个基础电路
- 每个电路3个编辑变体
- 8线程并行处理
- 渲染PNG图像
- 总共生成：1000个基础 + 3000个编辑变体 = 4000个电路

---

### 4. 快速生成（不渲染图像）

```bash
python ppm_construction/data_syn/generate.py \
    --gen_num 100 \
    --num_edits 3 \
    --num_proc 4 \
    --no_render
```

**效果**:
- 生成100个基础电路
- 每个电路3个编辑变体
- 4线程并行
- 不渲染图像（节省时间）
- 只生成LaTeX和SPICE文件

---

### 5. 指定输出目录

```bash
python ppm_construction/data_syn/generate.py \
    --gen_num 50 \
    --num_edits 3 \
    --output_dir ./data/my_dataset
```

**效果**:
- 生成50个基础电路
- 输出到自定义目录 `./data/my_dataset`

---

## 在Anaconda环境中运行

根据用户规则，项目运行在Anaconda虚拟环境中，需要先激活环境：

### Windows (PowerShell)

```powershell
# 激活虚拟环境（假设环境名为maps）
conda activate maps

# 切换到项目目录
cd c:\Users\tiany\Desktop\MAPS-master

# 运行数据生成
python ppm_construction/data_syn/generate.py --gen_num 100 --num_edits 3 --num_proc 4
```

### Linux/Mac

```bash
# 激活虚拟环境
conda activate maps

# 切换到项目目录
cd /path/to/MAPS-master

# 运行数据生成
python ppm_construction/data_syn/generate.py --gen_num 100 --num_edits 3 --num_proc 4
```

---

## 输出数据结构

运行后会生成以下目录结构：

```
output_dir/
  ├── 1_1/
  │   ├── base/
  │   │   ├── circuit.tex          # LaTeX原理图
  │   │   ├── circuit.sp           # SPICE代码
  │   │   ├── circuit.png          # 渲染图像（如果启用）
  │   │   ├── description.txt      # 电路描述
  │   │   └── stat.json            # 统计信息
  │   ├── edit_1/
  │   │   ├── circuit.tex
  │   │   ├── circuit.sp
  │   │   ├── circuit.png
  │   │   ├── edit_instruction.txt # 编辑描述
  │   │   └── stat.json
  │   ├── edit_2/
  │   │   └── ...
  │   ├── edit_3/
  │   │   └── ...
  │   └── metadata.json            # 元数据
  ├── 1_2/
  │   └── ...
  └── ...
```

---

## 性能建议

### 小规模测试（< 50个电路）
```bash
python ppm_construction/data_syn/generate.py --gen_num 10 --num_edits 2 --no_render
```
- 单线程即可
- 禁用渲染加快速度

### 中等规模（50-500个电路）
```bash
python ppm_construction/data_syn/generate.py --gen_num 200 --num_edits 3 --num_proc 4
```
- 使用4-8线程
- 根据CPU核心数调整

### 大规模（> 500个电路）
```bash
python ppm_construction/data_syn/generate.py --gen_num 1000 --num_edits 3 --num_proc 8 --render_image
```
- 使用8+线程
- 可以分批生成避免内存问题

---

## 注意事项

1. **渲染图像耗时**：如果不需要PNG图像，使用 `--no_render` 可以显著加快速度
2. **内存使用**：多线程会增加内存使用，根据机器配置调整 `--num_proc`
3. **磁盘空间**：每个电路包含多个文件，确保有足够磁盘空间
4. **LaTeX依赖**：渲染PNG需要安装 `pdflatex` 和 `ImageMagick`
5. **版本号**：`--note` 参数影响电路生成的规则版本

---

## 完整命令模板

```bash
# 激活环境
conda activate maps

# 切换到项目目录
cd c:\Users\tiany\Desktop\MAPS-master

# 生成数据（根据需求修改参数）
python ppm_construction/data_syn/generate.py \
    --note v11 \
    --gen_num 100 \
    --num_edits 3 \
    --num_proc 4 \
    --output_dir ./data/edit_dataset \
    --render_image
```

---

## 快速参考

```bash
# 最小测试
python ppm_construction/data_syn/generate.py --gen_num 1 --num_edits 1 --no_render

# 标准生成
python ppm_construction/data_syn/generate.py --gen_num 100 --num_edits 3 --num_proc 4

# 大规模生成
python ppm_construction/data_syn/generate.py --gen_num 1000 --num_edits 3 --num_proc 8 --render_image
```

---

*最后更新: 2025年*


